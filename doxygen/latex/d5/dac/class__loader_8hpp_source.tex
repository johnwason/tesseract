\hypertarget{class__loader_8hpp_source}{}\doxysection{class\+\_\+loader.\+hpp}
\label{class__loader_8hpp_source}\index{tesseract\_common/include/tesseract\_common/class\_loader.hpp@{tesseract\_common/include/tesseract\_common/class\_loader.hpp}}
\mbox{\hyperlink{class__loader_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#ifndef TESSERACT\_COMMON\_CLASS\_LOADER\_HPP}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define TESSERACT\_COMMON\_CLASS\_LOADER\_HPP}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{macros_8h}{tesseract\_common/macros.h}}>}}
\DoxyCodeLine{30 \mbox{\hyperlink{macros_8h_a8cc0e3c6a3382c5c0b19eb9e676fc2db}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <boost/config.hpp>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <boost/dll/import.hpp>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <boost/dll/alias.hpp>}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <boost/dll/import\_class.hpp>}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <boost/dll/shared\_library.hpp>}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include <console\_bridge/console.h>}}
\DoxyCodeLine{37 \mbox{\hyperlink{namespaceTESSERACT__COMMON__IGNORE__WARNINGS__POP}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{class__loader_8h}{tesseract\_common/class\_loader.h}}>}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__common}{tesseract\_common}}}
\DoxyCodeLine{42 \{}
\DoxyCodeLine{43 \textcolor{keyword}{template} <\textcolor{keyword}{class} ClassBase>}
\DoxyCodeLine{44 std::shared\_ptr<ClassBase> \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_ad1933611b2e5247267c29b146fb3054e}{ClassLoader::createSharedInstance}}(\textcolor{keyword}{const} std::string\& symbol\_name,}
\DoxyCodeLine{45                                                              \textcolor{keyword}{const} std::string\& library\_name,}
\DoxyCodeLine{46                                                              \textcolor{keyword}{const} std::string\& library\_directory)}
\DoxyCodeLine{47 \{}
\DoxyCodeLine{48   boost::system::error\_code ec;}
\DoxyCodeLine{49   boost::dll::shared\_library lib;}
\DoxyCodeLine{50   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{51   \{}
\DoxyCodeLine{52     boost::filesystem::path sl(library\_name);}
\DoxyCodeLine{53     boost::dll::load\_mode::type mode =}
\DoxyCodeLine{54         boost::dll::load\_mode::append\_decorations | boost::dll::load\_mode::search\_system\_folders;}
\DoxyCodeLine{55     lib = boost::dll::shared\_library(sl, ec, mode);}
\DoxyCodeLine{56   \}}
\DoxyCodeLine{57   \textcolor{keywordflow}{else}}
\DoxyCodeLine{58   \{}
\DoxyCodeLine{59     boost::filesystem::path sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{60     lib = boost::dll::shared\_library(sl, ec, boost::dll::load\_mode::append\_decorations);}
\DoxyCodeLine{61   \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63   \textcolor{comment}{// Check if it failed to find or load library}}
\DoxyCodeLine{64   \textcolor{keywordflow}{if} (ec)}
\DoxyCodeLine{65     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Failed to find or load library: "{}} + \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory) +}
\DoxyCodeLine{66                              \textcolor{stringliteral}{"{} with error: "{}} + ec.message());}
\DoxyCodeLine{67 }
\DoxyCodeLine{68   \textcolor{comment}{// Check if library has symbol}}
\DoxyCodeLine{69   \textcolor{keywordflow}{if} (!lib.has(symbol\_name))}
\DoxyCodeLine{70     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Failed to find symbol '"{}} + symbol\_name +}
\DoxyCodeLine{71                              \textcolor{stringliteral}{"{}' in library: "{}} + \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory));}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{preprocessor}{\#if BOOST\_VERSION >= 107600}}
\DoxyCodeLine{74   boost::shared\_ptr<ClassBase> plugin = boost::dll::import\_symbol<ClassBase>(lib, symbol\_name);}
\DoxyCodeLine{75 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{76   boost::shared\_ptr<ClassBase> plugin = boost::dll::import<ClassBase>(lib, symbol\_name);}
\DoxyCodeLine{77 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{78   \textcolor{keywordflow}{return} std::shared\_ptr<ClassBase>(plugin.get(), [plugin](ClassBase*) \textcolor{keyword}{mutable} \{ plugin.reset(); \});}
\DoxyCodeLine{79 \}}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{keywordtype}{bool} \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a0bc9e092d94b12566d67e5a5ee0de337}{ClassLoader::isClassAvailable}}(\textcolor{keyword}{const} std::string\& symbol\_name,}
\DoxyCodeLine{82                                    \textcolor{keyword}{const} std::string\& library\_name,}
\DoxyCodeLine{83                                    \textcolor{keyword}{const} std::string\& library\_directory)}
\DoxyCodeLine{84 \{}
\DoxyCodeLine{85   boost::system::error\_code ec;}
\DoxyCodeLine{86   boost::dll::shared\_library lib;}
\DoxyCodeLine{87   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{88   \{}
\DoxyCodeLine{89     boost::filesystem::path sl(library\_name);}
\DoxyCodeLine{90     boost::dll::load\_mode::type mode =}
\DoxyCodeLine{91         boost::dll::load\_mode::append\_decorations | boost::dll::load\_mode::search\_system\_folders;}
\DoxyCodeLine{92     lib = boost::dll::shared\_library(sl, ec, mode);}
\DoxyCodeLine{93   \}}
\DoxyCodeLine{94   \textcolor{keywordflow}{else}}
\DoxyCodeLine{95   \{}
\DoxyCodeLine{96     boost::filesystem::path sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{97     lib = boost::dll::shared\_library(sl, ec, boost::dll::load\_mode::append\_decorations);}
\DoxyCodeLine{98   \}}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{comment}{// Check if it failed to find or load library}}
\DoxyCodeLine{101   \textcolor{keywordflow}{if} (ec)}
\DoxyCodeLine{102   \{}
\DoxyCodeLine{103     CONSOLE\_BRIDGE\_logDebug(\textcolor{stringliteral}{"{}Failed to find or load library: \%s with error: \%s"{}},}
\DoxyCodeLine{104                             \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory).c\_str(),}
\DoxyCodeLine{105                             ec.message().c\_str());}
\DoxyCodeLine{106     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{107   \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109   \textcolor{keywordflow}{return} lib.has(symbol\_name);}
\DoxyCodeLine{110 \}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112 std::vector<std::string> \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a8d2d1f0b2f092748c0b0450955a8d9e0}{ClassLoader::getAvailableSymbols}}(\textcolor{keyword}{const} std::string\& section,}
\DoxyCodeLine{113                                                           \textcolor{keyword}{const} std::string\& library\_name,}
\DoxyCodeLine{114                                                           \textcolor{keyword}{const} std::string\& library\_directory)}
\DoxyCodeLine{115 \{}
\DoxyCodeLine{116   boost::system::error\_code ec;}
\DoxyCodeLine{117   boost::dll::shared\_library lib;}
\DoxyCodeLine{118   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{119   \{}
\DoxyCodeLine{120     boost::filesystem::path sl(library\_name);}
\DoxyCodeLine{121     boost::dll::load\_mode::type mode =}
\DoxyCodeLine{122         boost::dll::load\_mode::append\_decorations | boost::dll::load\_mode::search\_system\_folders;}
\DoxyCodeLine{123     lib = boost::dll::shared\_library(sl, ec, mode);}
\DoxyCodeLine{124   \}}
\DoxyCodeLine{125   \textcolor{keywordflow}{else}}
\DoxyCodeLine{126   \{}
\DoxyCodeLine{127     boost::filesystem::path sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{128     lib = boost::dll::shared\_library(sl, ec, boost::dll::load\_mode::append\_decorations);}
\DoxyCodeLine{129   \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131   \textcolor{comment}{// Check if it failed to find or load library}}
\DoxyCodeLine{132   \textcolor{keywordflow}{if} (ec)}
\DoxyCodeLine{133   \{}
\DoxyCodeLine{134     CONSOLE\_BRIDGE\_logDebug(\textcolor{stringliteral}{"{}Failed to find or load library: \%s with error: \%s"{}},}
\DoxyCodeLine{135                             \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory).c\_str(),}
\DoxyCodeLine{136                             ec.message().c\_str());}
\DoxyCodeLine{137     \textcolor{keywordflow}{return} std::vector<std::string>();}
\DoxyCodeLine{138   \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{140   \textcolor{comment}{// Class `library\_info` can extract information from a library}}
\DoxyCodeLine{141   boost::dll::library\_info inf(lib.location());}
\DoxyCodeLine{142 }
\DoxyCodeLine{143   \textcolor{comment}{// Getting symbols exported from he provided section}}
\DoxyCodeLine{144   \textcolor{keywordflow}{return} inf.symbols(section);}
\DoxyCodeLine{145 \}}
\DoxyCodeLine{146 }
\DoxyCodeLine{147 std::vector<std::string> \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_a816ec5cb50eb1a7011b561dd0d789494}{ClassLoader::getAvailableSections}}(\textcolor{keyword}{const} std::string\& library\_name,}
\DoxyCodeLine{148                                                            \textcolor{keyword}{const} std::string\& library\_directory,}
\DoxyCodeLine{149                                                            \textcolor{keywordtype}{bool} include\_hidden)}
\DoxyCodeLine{150 \{}
\DoxyCodeLine{151   boost::system::error\_code ec;}
\DoxyCodeLine{152   boost::dll::shared\_library lib;}
\DoxyCodeLine{153   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{154   \{}
\DoxyCodeLine{155     boost::filesystem::path sl(library\_name);}
\DoxyCodeLine{156     boost::dll::load\_mode::type mode =}
\DoxyCodeLine{157         boost::dll::load\_mode::append\_decorations | boost::dll::load\_mode::search\_system\_folders;}
\DoxyCodeLine{158     lib = boost::dll::shared\_library(sl, ec, mode);}
\DoxyCodeLine{159   \}}
\DoxyCodeLine{160   \textcolor{keywordflow}{else}}
\DoxyCodeLine{161   \{}
\DoxyCodeLine{162     boost::filesystem::path sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{163     lib = boost::dll::shared\_library(sl, ec, boost::dll::load\_mode::append\_decorations);}
\DoxyCodeLine{164   \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{166   \textcolor{comment}{// Check if it failed to find or load library}}
\DoxyCodeLine{167   \textcolor{keywordflow}{if} (ec)}
\DoxyCodeLine{168   \{}
\DoxyCodeLine{169     CONSOLE\_BRIDGE\_logDebug(\textcolor{stringliteral}{"{}Failed to find or load library: \%s with error: \%s"{}},}
\DoxyCodeLine{170                             \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{decorate}}(library\_name, library\_directory).c\_str(),}
\DoxyCodeLine{171                             ec.message().c\_str());}
\DoxyCodeLine{172     \textcolor{keywordflow}{return} std::vector<std::string>();}
\DoxyCodeLine{173   \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{175   \textcolor{comment}{// Class `library\_info` can extract information from a library}}
\DoxyCodeLine{176   boost::dll::library\_info inf(lib.location());}
\DoxyCodeLine{177 }
\DoxyCodeLine{178   \textcolor{comment}{// Getting section from library}}
\DoxyCodeLine{179   std::vector<std::string> sections = inf.sections();}
\DoxyCodeLine{180 }
\DoxyCodeLine{181   \textcolor{keyword}{auto} search\_fn = [include\_hidden](\textcolor{keyword}{const} std::string\& section) \{}
\DoxyCodeLine{182     \textcolor{keywordflow}{if} (section.empty())}
\DoxyCodeLine{183       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{184 }
\DoxyCodeLine{185     \textcolor{keywordflow}{if} (include\_hidden)}
\DoxyCodeLine{186       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{187 }
\DoxyCodeLine{188     \textcolor{keywordflow}{return} (section.substr(0, 1) == \textcolor{stringliteral}{"{}."{}});}
\DoxyCodeLine{189   \};}
\DoxyCodeLine{190 }
\DoxyCodeLine{191   sections.erase(std::remove\_if(sections.begin(), sections.end(), search\_fn), sections.end());}
\DoxyCodeLine{192   \textcolor{keywordflow}{return} sections;}
\DoxyCodeLine{193 \}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195 std::string \mbox{\hyperlink{structtesseract__common_1_1ClassLoader_af2749622fe3be804a464ce5d5ea62ca9}{ClassLoader::decorate}}(\textcolor{keyword}{const} std::string\& library\_name, \textcolor{keyword}{const} std::string\& library\_directory)}
\DoxyCodeLine{196 \{}
\DoxyCodeLine{197   boost::filesystem::path sl;}
\DoxyCodeLine{198   \textcolor{keywordflow}{if} (library\_directory.empty())}
\DoxyCodeLine{199     sl = boost::filesystem::path(library\_name);}
\DoxyCodeLine{200   \textcolor{keywordflow}{else}}
\DoxyCodeLine{201     sl = boost::filesystem::path(library\_directory) / library\_name;}
\DoxyCodeLine{202 }
\DoxyCodeLine{203   boost::filesystem::path actual\_path =}
\DoxyCodeLine{204       (std::strncmp(sl.filename().string().c\_str(), \textcolor{stringliteral}{"{}lib"{}}, 3) != 0 ?}
\DoxyCodeLine{205            boost::filesystem::path((sl.has\_parent\_path() ? sl.parent\_path() / L\textcolor{stringliteral}{"{}lib"{}} : L\textcolor{stringliteral}{"{}lib"{}}).native() +}
\DoxyCodeLine{206                                    sl.filename().native()) :}
\DoxyCodeLine{207            sl);}
\DoxyCodeLine{208 }
\DoxyCodeLine{209   actual\_path += boost::dll::shared\_library::suffix();}
\DoxyCodeLine{210   \textcolor{keywordflow}{return} actual\_path.string();}
\DoxyCodeLine{211 \}}
\DoxyCodeLine{212 }
\DoxyCodeLine{213 \}  \textcolor{comment}{// namespace tesseract\_common}}
\DoxyCodeLine{214 }
\DoxyCodeLine{215 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// TESSERACT\_COMMON\_CLASS\_LOADER\_HPP}}

\end{DoxyCode}
